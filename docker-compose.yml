services:
  tvclipboard:
    # Build from local Dockerfile (for development/testing)
    build: .
    # image: akitaonrails/tvclipboard:latest

    # OR pull from Docker Hub (uncomment for production use)
    # image: akitaonrails/tvclipboard:latest

    container_name: tvclipboard
    restart: unless-stopped

    # Port mapping: host:container
    ports:
      - "3333:3333"

    # Environment variables (optional)
    environment:
      # Port to listen on (default: 3333)
      - PORT=3333

      # Public base URL for QR codes (e.g., https://example.com)
      # If not set, automatically detects local IP address
      # Useful for deployments with public domain names
      - TVCLIPBOARD_PUBLIC_URL=https://example.com

      # Session timeout in minutes (default: 10)
      # After this time, QR codes expire and clients are disconnected
      - TVCLIPBOARD_SESSION_TIMEOUT=10

      # Public base URL for QR codes (e.g., https://example.com)
      # Set this for public deployments so QR codes use your domain instead of local IP
      - TVCLIPBOARD_PUBLIC_URL=https://example.com

      # Optional: 32-byte hex private key for token encryption
      # If not set, a random key is generated on each container restart
      # Set this for persistent encryption across restarts
      # Example: TVCLIPBOARD_PRIVATE_KEY="a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456"
      # - TVCLIPBOARD_PRIVATE_KEY=""

    # Networks
    networks:
      - tvclipboard-net

    # Health check
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:3333/"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 5s

networks:
  tvclipboard-net:
    driver: bridge
